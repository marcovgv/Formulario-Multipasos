<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <title>Formulario Multipasos</title>
</head>
 <style>
      * {
        box-sizing: border-box;
      }

      .posicion.drop-effect {
        animation: scaleUp 0.3s ease;
      }

      @keyframes scaleUp {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }

      #jugadores {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 1000px;
        margin-bottom: 15px;
        gap: 8px;
        background: white;
        padding: 10px;
        border-radius: 10px;
        border: 2px solid #ccc;
        width: 90%;
      }

      .jugador-wrapper {
        position: relative;
        user-select: none;
      }

      .jugador {
        width: 45px;
        height: 45px;
        background-color: red;
        color: white;
        font-weight: bold;
        border-radius: 50%;
        line-height: 45px;
        cursor: move;
        text-align: center;
        font-size: 14px;
        box-shadow: 0 0 5px #a00;
        transition: transform 0.2s;
      }

      .jugador:active {
        transform: scale(1.1);
      }

      .tooltip {
        visibility: hidden;
        width: 150px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 8px;
        border-radius: 5px;
        position: absolute;
        top: -90px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 12px;
        pointer-events: none;
      }

      .jugador-wrapper:hover .tooltip {
        visibility: visible;
        opacity: 1;
      }

      #cancha {
        width: 100%;
        aspect-ratio: 1.7 / 1;
        height: auto;
        max-height: 530px;
        background-image: url("canchas.jpeg");
        background-size: contain; /* Cambia cover por contain */
        background-position: center;
        background-repeat: no-repeat;
       
        border-radius: 50px / 20px;
        position: relative;
 
        margin-bottom: 25px;
        user-select: none;
        overflow: hidden;
      }
      @media (max-width: 700px) {
        #cancha {
          max-height: none;
          height: auto;
          min-height: 180px;
          border-width: 3px;
          border-radius: 20px / 10px;
        }
      }
      @media (max-width: 500px) {
        #cancha {
          max-height: none;
          height: auto;
          min-height: 120px;
          border-width: 2px;
          border-radius: 12px / 6px;
        }
      }

      .posicion {
        width: 40px;
        height: 40px;
        border: 2px dashed white;
        border-radius: 50%;
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: background-color 0.3s;
        user-select: none;
      }

      .posicion:hover {
        background-color: rgba(255, 255, 255, 0.25);
      }

      /* Posiciones específicas */
      .p1  { top: 10%;  left: 5%; }
      .p2  { top: 25%;  left: 15%; }
      .p3  { top: 40%;  left: 10%; }
      .p4  { top: 60%;  left: 10%; }
      .p5  { top: 75%;  left: 15%; }
      .p6  { top: 20%;  left: 30%; }
      .p7  { top: 50%;  left: 25%; }
      .p8  { top: 80%;  left: 30%; }
      .p9  { top: 15%;  left: 45%; }
      .p10 { top: 50%;  left: 50%; }
      .p11 { top: 85%;  left: 45%; }
      .p12 { top: 20%;  left: 65%; }
      .p13 { top: 50%;  left: 70%; }
      .p14 { top: 80%;  left: 65%; }
      .p15 { top: 25%;  left: 85%; }
      .p16 { top: 40%;  left: 90%; }
      .p17 { top: 60%;  left: 90%; }
      .p18 { top: 75%;  left: 85%; }

      .botones {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        width: 90%;
        max-width: 600px;
        margin-bottom: 30px;
      }

      button {
        padding: 12px 25px;
        font-size: 16px;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        background-color: #004d00;
        color: white;
        transition: background 0.3s;
        min-width: 170px;
        user-select: none;
        box-shadow: 0 0 8px #003300aa;
      }

      button:hover {
        background-color: #007700;
      }

      @media (max-width: 500px) {
        .jugador {
          width: 36px;
          height: 36px;
          font-size: 12px;
          line-height: 36px;
        }
        .posicion {
          width: 32px;
          height: 32px;
        }
        button {
          min-width: 100%;
        }
      }
      #tarjeta-jugador {
        position: absolute;
        top: 100px; /* Ajusta según necesites */
        left: 960px; /* Un poco a la derecha de la cancha (que tiene max-width 900px) */
        width: 200px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 0 10px #333;
        padding: 15px;
        user-select: none;
        font-family: Arial, sans-serif;
        color: #004d00;
      }
    </style>
<body class="bg-gray-50 font-sans">
  <div class="min-h-screen flex justify-center">
    <div class="w-full max-w-lg bg-white shadow-lg rounded-lg p-8">
      <!-- Step Indicator with Progress Bar -->
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4 w-full">
          <!-- Step 1 -->
          <div class="relative flex-1 flex items-center">
            <div id="indicator-1" class="w-10 h-10 flex items-center justify-center bg-blue-500 text-white rounded-full transition-colors duration-300">1</div>
            <div id="line-1" class="absolute w-full h-1 bg-gray-300 left-0 top-1/2 transform translate-y-[-50%] z-[-1] transition-colors duration-300"></div>
          </div>
          <!-- Step 2 -->
          <div class="relative flex-1 flex items-center">
            <div id="indicator-2" class="w-10 h-10 flex items-center justify-center bg-gray-300 text-gray-600 rounded-full transition-colors duration-300">2</div>
            <div id="line-2" class="absolute w-full h-1 bg-gray-300 left-0 top-1/2 transform translate-y-[-50%] z-[-1] transition-colors duration-300"></div>
          </div>
          <!-- Step 3 -->
          <div>
            <div id="indicator-3" class="w-10 h-10 flex items-center justify-center bg-gray-300 text-gray-600 rounded-full transition-colors duration-300">3</div>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="w-full bg-gray-200 rounded-full h-2 mb-8">
        <div id="progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%;"></div>
      </div>

      <!-- Form Content -->
      <form id="multi-step-form">
        <!-- Step 1 -->
        <div id="step-1" class="step">
          <h2 class="text-xl font-semibold mb-4">Registro</h2>
          <div class="space-y-4">
            <input type="text" placeholder="Nombre" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-blue-500">
            <input type="email" placeholder="Email" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-blue-500">
            <input type="tel" placeholder="telefono" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-blue-500">
          </div>
        </div>

        <!-- Step 2 -->
        <div id="step-2" class="step hidden">
          <h1>Arrastra y suelta los jugadores a la cancha</h1>

          <div class="flex flex-wrap justify-center gap-2 mb-4" id="jugadores"></div>
<div class="flex flex-col sm:flex-row justify-between gap-2 mt-8">
            <button type="button" id="reset-cancha-btn" class="bg-red-500 text-white px-4 py-2 rounded mb-2 w-full sm:w-auto">Resetear cancha</button>
       <!--<button type="button" id="capturar-cancha-btn" class="bg-blue-600 text-white px-4 py-2 rounded mb-2 w-full sm:w-auto">Capturar cancha</button>-->
          </div>
          <div id="cancha">
            <div class="posicion p1"></div>
            <div class="posicion p2"></div>
            <div class="posicion p3"></div>
            <div class="posicion p4"></div>
            <div class="posicion p5"></div>
            <div class="posicion p6"></div>
            <div class="posicion p7"></div>
            <div class="posicion p8"></div>
            <div class="posicion p9"></div>
            <div class="posicion p10"></div>
            <div class="posicion p11"></div>
            <div class="posicion p12"></div>
            <div class="posicion p13"></div>
            <div class="posicion p14"></div>
            <div class="posicion p15"></div>
            <div class="posicion p16"></div>
            <div class="posicion p17"></div>
            <div class="posicion p18"></div>
          </div>
          
          
        </div>

        <!-- Step 3 -->
        <div id="step-3" class="step hidden">
          <h2 class="text-xl font-semibold mb-4">Paso 3: Revisar y enviar</h2>
          <p class="mb-4">Por favor, revise su información antes de enviar.</p>
          <ul class="list-disc pl-5 space-y-2">
            <li><strong>Nombre:</strong> <span id="review-name">John Doe</span></li>
            <li><strong>Email:</strong> <span id="review-email">john.doe@example.com</span></li>
            <li><strong>Teléfono:</strong> <span id="review-telefono"></span></li>
          </ul>
          <div class="mt-6">
            <h3 class="font-semibold mb-2">Cancha seleccionada:</h3>
            <div id="cancha-capturada" class="border rounded p-2 bg-gray-100 flex justify-center"></div>
            <input type="hidden" id="cancha-img-data" name="cancha-img-data" />
          </div>
        </div>

        <!-- Navigation -->
        <div class="grid grid-cols-2 justify-between mt-2">
          <button id="prev-btn" type="button" class="bg-gray-300 text-gray-700 px-2 py-2 rounded-lg hidden">Atras</button>
          <button id="next-btn" type="button" class="bg-blue-500 text-white px-2 py-2 rounded-lg">Siguiente</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const steps = document.querySelectorAll(".step");
    const nextBtn = document.getElementById("next-btn");
    const prevBtn = document.getElementById("prev-btn");
    const indicators = [
      document.getElementById("indicator-1"),
      document.getElementById("indicator-2"),
      document.getElementById("indicator-3")
    ];
    const lines = [
      document.getElementById("line-1"),
      document.getElementById("line-2")
    ];
    const progressBar = document.getElementById("progress-bar");
    let currentStep = 0;

    function updateIndicators(stepIndex) {
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle("bg-blue-500", index <= stepIndex);
        indicator.classList.toggle("text-white", index <= stepIndex);
        indicator.classList.toggle("bg-gray-300", index > stepIndex);
        indicator.classList.toggle("text-gray-600", index > stepIndex);
      });

      lines.forEach((line, index) => {
        line.classList.toggle("bg-blue-500", index < stepIndex);
        line.classList.toggle("bg-gray-300", index >= stepIndex);
      });
    }

    function updateProgressBar(stepIndex) {
      const progressPercentage = ((stepIndex + 1) / steps.length) * 100;
      progressBar.style.width = `${progressPercentage}%`;
    }

    function showStep(index) {
      steps.forEach((step, i) => {
        step.classList.toggle("hidden", i !== index);
      });
      prevBtn.classList.toggle("hidden", index === 0);
      nextBtn.textContent = index === steps.length - 1 ? "Submit" : "Siguiente";
      updateIndicators(index);
      updateProgressBar(index);

      // Mostrar datos en el paso 3
      if (index === 2) {
        document.getElementById("review-name").textContent = document.querySelector('input[placeholder="Nombre"]').value;
        document.getElementById("review-email").textContent = document.querySelector('input[placeholder="Email"]').value;
        document.getElementById("review-telefono").textContent = document.querySelector('input[placeholder="telefono"]').value;
        // Mostrar imagen de la cancha si existe o capturar si no existe
        const imgData = document.getElementById("cancha-img-data").value;
        if (imgData) {
          document.getElementById("cancha-capturada").innerHTML = `<img src="${imgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
        } else {
          // Si no hay imagen, intenta capturarla automáticamente
          const cancha = document.getElementById("cancha");
          html2canvas(cancha, {
            useCORS: true,
            backgroundColor: null,
            scale: window.devicePixelRatio || 1,
            allowTaint: true,
            removeContainer: true
          }).then(canvas => {
            const autoImgData = canvas.toDataURL("image/png");
            document.getElementById("cancha-img-data").value = autoImgData;
            document.getElementById("cancha-capturada").innerHTML = `<img src="${autoImgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
          }).catch(() => {
            document.getElementById("cancha-capturada").innerHTML = `<span class="text-red-500">No se pudo capturar la imagen de la cancha.</span>`;
          });
        }
      }
    }

    nextBtn.addEventListener("click", async () => {
      // Validación para avanzar del paso 1 al 2
      if (currentStep === 0) {
        const nombre = document.querySelector('input[placeholder="Nombre"]');
        const email = document.querySelector('input[placeholder="Email"]');
        const telefono = document.querySelector('input[placeholder="telefono"]');
        if (!nombre.value.trim() || !email.value.trim() || !telefono.value.trim()) {
          alert("Por favor, completa todos los campos.");
          return;
        }
      }
      // Validación para avanzar del paso 2 al 3: todas las posiciones ocupadas
      if (currentStep === 1) {
        const posiciones = document.querySelectorAll(".posicion");
        const todasOcupadas = Array.from(posiciones).every(pos => pos.children.length > 0);
        if (!todasOcupadas) {
          alert("Debes colocar un jugador en cada posición de la cancha.");
          return;
        }
        // Captura la imagen de la cancha y la guarda en el formulario
        const cancha = document.getElementById("cancha");
        try {
          const canvas = await html2canvas(cancha, {useCORS: true, backgroundColor: null});
          const imgData = canvas.toDataURL("image/png");
          document.getElementById("cancha-img-data").value = imgData;
          document.getElementById("cancha-capturada").innerHTML = `<img src="${imgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
        } catch (e) {
          alert("No se pudo capturar la imagen de la cancha, pero puedes continuar.");
        }
      }
      // Avanza de paso SIEMPRE después de la captura
      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
      } else {
        alert("¡Formulario enviado!");
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });

    showStep(currentStep);
  </script>
    <script>
      const jugadoresContainer = document.getElementById("jugadores");
      const posiciones = document.querySelectorAll(".posicion");
      let jugadorSeleccionado = null; // Para modo clic en móvil

      const nombres = [
        "Portero",
        "Lateral Izq.",
        "Lateral Der.",
        "Central 1",
        "Central 2",
        "Medio Def. 1",
        "Medio Def. 2",
        "Medio Of. 1",
        "Medio Of. 2",
        "Enganche",
        "Delantero Izq.",
        "Delantero Der.",
        "Extremo Izq.",
        "Extremo Der.",
        "Punta 1",
        "Punta 2",
        "Segundo Punta",
        "Falso 9",
      ];

      const camisetaUrl = "./camisa-jugador.png";

      // Mostrar jugadores SOLO cuando el paso 2 está visible
      function renderJugadores() {
        jugadoresContainer.innerHTML = "";
        for (let i = 1; i <= 18; i++) {
          const wrapper = document.createElement("div");
          wrapper.className = "jugador-wrapper";
          wrapper.id = "jugador-wrapper" + i;

          const jugador = document.createElement("div");
          jugador.className = "jugador";
          jugador.id = "jugador" + i;
          jugador.draggable = true;
          jugador.textContent = i;
          jugador.addEventListener("dragstart", dragStart);

          // Selección por clic (para móvil)
          jugador.addEventListener("click", function (e) {
            // Si ya está seleccionado, deselecciona
            if (jugadorSeleccionado === wrapper) {
              wrapper.classList.remove("ring", "ring-blue-500");
              jugadorSeleccionado = null;
              return;
            }
            // Deselecciona el anterior
            if (jugadorSeleccionado) {
              jugadorSeleccionado.classList.remove("ring", "ring-blue-500");
            }
            jugadorSeleccionado = wrapper;
            wrapper.classList.add("ring", "ring-blue-500");
          });

          const tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          tooltip.innerHTML = `
            <strong>${nombres[i - 1]}</strong><br>
            <img src="${camisetaUrl}" width="40" height="40" />
          `;

          wrapper.appendChild(jugador);
          wrapper.appendChild(tooltip);
          jugadoresContainer.appendChild(wrapper);

          // Evento click para mostrar info
          jugador.addEventListener("dblclick", () => {
            const nombreJugadorElem = document.getElementById("nombre-jugador");
            const numeroJugadorElem = document.getElementById("numero-jugador");
            nombreJugadorElem.textContent = nombres[i - 1];
            numeroJugadorElem.textContent = i;
            document.getElementById("tarjeta-jugador").style.display = "block";
          });
        }
      }

      function dragStart(e) {
        e.dataTransfer.setData("text", e.target.parentElement.id);
      }

      // Drag & Drop
      posiciones.forEach((pos) => {
        pos.addEventListener("dragover", (e) => {
          e.preventDefault();
        });

        pos.addEventListener("drop", (e) => {
          e.preventDefault();
          const wrapperId = e.dataTransfer.getData("text");
          const wrapper = document.getElementById(wrapperId);

          if (pos.children.length === 0) {
            pos.appendChild(wrapper);
            pos.classList.add("drop-effect");
            setTimeout(() => {
              pos.classList.remove("drop-effect");
            }, 300);
          }
        });

        // Soporte para pegar por clic en móvil
        pos.addEventListener("click", function () {
          if (jugadorSeleccionado && pos.children.length === 0) {
            pos.appendChild(jugadorSeleccionado);
            pos.classList.add("drop-effect");
            setTimeout(() => {
              pos.classList.remove("drop-effect");
            }, 300);
            jugadorSeleccionado.classList.remove("ring", "ring-blue-500");
            jugadorSeleccionado = null;
          }
        });
      });

      // Mostrar jugadores solo al entrar al paso 2
      function showStep(index) {
        steps.forEach((step, i) => {
          step.classList.toggle("hidden", i !== index);
        });
        prevBtn.classList.toggle("hidden", index === 0);
        nextBtn.textContent = index === steps.length - 1 ? "Enviar" : "Siguiente";
        updateIndicators(index);
        updateProgressBar(index);

        // Mostrar datos en el paso 3
        if (index === 2) {
          document.getElementById("review-name").textContent = document.querySelector('input[placeholder="Nombre"]').value;
          document.getElementById("review-email").textContent = document.querySelector('input[placeholder="Email"]').value;
          document.getElementById("review-telefono").textContent = document.querySelector('input[placeholder="telefono"]').value;
          // Mostrar imagen de la cancha si existe o capturar si no existe
          const imgData = document.getElementById("cancha-img-data").value;
          if (imgData) {
            document.getElementById("cancha-capturada").innerHTML = `<img src="${imgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
          } else {
            // Si no hay imagen, intenta capturarla automáticamente
            const cancha = document.getElementById("cancha");
            html2canvas(cancha, {
              useCORS: true,
              backgroundColor: null,
              scale: window.devicePixelRatio || 1,
              allowTaint: true,
              removeContainer: true
            }).then(canvas => {
              const autoImgData = canvas.toDataURL("image/png");
              document.getElementById("cancha-img-data").value = autoImgData;
              document.getElementById("cancha-capturada").innerHTML = `<img src="${autoImgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
            }).catch(() => {
              document.getElementById("cancha-capturada").innerHTML = `<span class="text-red-500">No se pudo capturar la imagen de la cancha.</span>`;
            });
          }
        }

        if (index === 1) {
          renderJugadores();
        }
      }

      // Botón para resetear la cancha
      document.getElementById("reset-cancha-btn").addEventListener("click", () => {
        // Mover todos los jugadores de las posiciones de vuelta al contenedor de jugadores
        const jugadoresContainer = document.getElementById("jugadores");
        document.querySelectorAll(".posicion").forEach(pos => {
          while (pos.firstChild) {
            jugadoresContainer.appendChild(pos.firstChild);
          }
        });
        // Vuelve a renderizar los jugadores para evitar duplicados
        renderJugadores();
      });

      // Botón para capturar la imagen de la cancha y mostrarla en el paso 3
      document.getElementById("capturar-cancha-btn").addEventListener("click", async () => {
        const cancha = document.getElementById("cancha");
        try {
          // Espera un pequeño tiempo para asegurar que el DOM esté listo
          await new Promise(res => setTimeout(res, 100));
          const canvas = await html2canvas(cancha, {
            useCORS: true,
            backgroundColor: null,
            logging: true,
            scale: window.devicePixelRatio || 1,
            allowTaint: true,
            removeContainer: true
          });
          const imgData = canvas.toDataURL("image/png");
          document.getElementById("cancha-img-data").value = imgData;
          // Si ya estamos en el paso 3, mostrar la imagen
          if (!document.getElementById("step-3").classList.contains("hidden")) {
            document.getElementById("cancha-capturada").innerHTML = `<img src="${imgData}" alt="Cancha seleccionada" class="rounded shadow max-w-full" />`;
          } else {
            alert("¡Cancha capturada! Avanza al siguiente paso para verla en el registro.");
          }
        } catch (e) {
          alert("No se pudo capturar la imagen de la cancha. Si tienes extensiones de navegador de bloqueo de contenido, intenta desactivarlas o recarga la página.");
        }
      });
    </script>
</body>
</html>




<!DOCTYPE html>
<html lang="es" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Formulario Multipasos</title>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
      
      /* Ajustes para móviles */
      @media (max-width: 600px) {
        .container {
          max-width: 100%;
          padding: 15px;
        }
        .progress-bar p {
          font-size: 0.75rem;
        }
        #cancha {
          width: 100vw;
          max-width: 100%;
          height: auto;
          aspect-ratio: 1.7 / 1;
          border-width: 3px;
          border-radius: 30px / 15px;
        }
        .jugador {
          width: 40px;
          height: 40px;
          font-size: 16px;
          line-height: 40px;
        }
        .posicion {
          width: 36px;
          height: 36px;
          border-width: 2px;
        }
        button {
          min-width: 100%;
          padding: 14px 0;
          font-size: 18px;
        }
        input, select {
          font-size: 1.1rem;
          padding: 12px;
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }
      body {
        background: #f5f6fa;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 15px;
      }
      .container {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        width: 100%;
        max-width: 500px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      header {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
        text-align: center;
      }

      .progress-bar {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      .progress-bar::before {
        content: "";
        position: absolute;
        top: 14px;
        left: 30px;
        width: calc(100% - 60px);
        height: 4px;
        background: #dcdde1;
        z-index: 0;
      }
      .step {
        text-align: center;
        z-index: 1;
        flex: 1;
        min-width: 60px;
      }
      .step p {
        font-size: 0.8rem;
        margin-bottom: 5px;
        color: #7f8c8d;
        transition: color 0.3s ease;
      }
      .step p.active {
        color: green;
        font-weight: bold;
      }
      .bullet {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #dcdde1;
        display: inline-block;
        line-height: 25px;
        color: white;
        position: relative;
        transition: background 0.3s ease;
      }
      .bullet.active {
        background: green;
      }
      .check {
        display: none;
        color: white;
        position: absolute;
        top: 0;
        left: 0;
        width: 25px;
        height: 25px;
        line-height: 25px;
        border-radius: 50%;
        background: green;
        font-size: 12px;
      }
      .check.active {
        display: block;
      }

      .form-outer {
        width: 100%;
        overflow: hidden;
      }
      form {
        display: flex;
        width: 200%; /* Solo 2 pasos visibles */
        transition: margin-left 0.5s ease-in-out;
      }
      .page {
        width: 50%;
        padding: 10px;
      }
      .field {
        margin-bottom: 15px;
      }
      label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 5px;
      }
      input,
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
      }
      .btns {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
      button {
        flex: 1;
        min-width: 100px;
        padding: 8px 16px;
        background: green;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
        user-select: none;
      }
      button:hover {
        background: darkgreen;
      }
      .success-message {
        text-align: center;
        padding: 20px;
      }
      .success-message h2 {
        color: green;
        margin-bottom: 10px;
      }

      /* RESPONSIVE */
      @media (max-width: 600px) {
        .progress-bar {
          flex-direction: column;
          align-items: center;
        }
        .progress-bar::before {
          display: none;
        }
        .step {
          margin-bottom: 10px;
        }
        .page {
          padding: 5px;
        }
        input,
        select,
        button {
          font-size: 1rem;
        }
      }

      /* cancha */
      .posicion.drop-effect {
        animation: scaleUp 0.3s ease;
      }
      @keyframes scaleUp {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }
      #jugadores {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 1000px;
        margin-bottom: 15px;
        gap: 8px;
        background: white;
        padding: 10px;
        border-radius: 10px;
        border: 2px solid #ccc;
        width: 90%;
      }
      .jugador-wrapper {
        position: relative;
        user-select: none;
      }
      .jugador {
        width: 45px;
        height: 45px;
        background-color: red;
        color: white;
        font-weight: bold;
        border-radius: 50%;
        line-height: 45px;
        cursor: move;
        text-align: center;
        font-size: 14px;
        box-shadow: 0 0 5px #a00;
        transition: transform 0.2s;
        user-select: none;
      }
      .jugador:active {
        transform: scale(1.1);
      }
      .tooltip {
        visibility: hidden;
        width: 150px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 8px;
        border-radius: 5px;
        position: absolute;
        top: -90px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 12px;
        pointer-events: none;
      }
      .jugador-wrapper:hover .tooltip {
        visibility: visible;
        opacity: 1;
      }
      #cancha {
        width: 95vw;
        max-height: 530px;
        background-image: url("canchas.jpeg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border: 5px solid #004d00;
        border-radius: 50px / 20px;
        position: relative;
        box-shadow: 0 0 15px #006600aa inset;
        margin-bottom: 25px;
        user-select: none;
        overflow: hidden;
        max-width: 100%;
        height: auto;
        aspect-ratio: 1.7 / 1;
      }
      .posicion {
        width: 40px;
        height: 40px;
        border: 2px dashed white;
        border-radius: 50%;
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: background-color 0.3s;
        user-select: none;
      }
      .posicion:hover {
        background-color: rgba(255, 255, 255, 0.25);
      }
      /* Posiciones específicas */
      .p1 {
        top: 10%;
        left: 48%;
      }
      .p2 {
        top: 25%;
        left: 10%;
      }
      .p3 {
        top: 25%;
        left: 25%;
      }
      .p4 {
        top: 25%;
        left: 40%;
      }
      .p5 {
        top: 25%;
        left: 60%;
      }
      .p6 {
        top: 25%;
        left: 75%;
      }
      .p7 {
        top: 45%;
        left: 20%;
      }
      .p8 {
        top: 45%;
        left: 40%;
      }
      .p9 {
        top: 45%;
        left: 60%;
      }
      .p10 {
        top: 45%;
        left: 80%;
      }
      .p11 {
        top: 75%;
        left: 48%;
      }

      /* Tarjeta jugador */
      #tarjeta-jugador {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
        display: none;
        z-index: 9999;
        min-width: 280px;
        max-width: 90vw;
        user-select: none;
      }
      #tarjeta-jugador img {
        display: block;
        margin: 0 auto 15px;
        width: 110px;
        border-radius: 20px;
      }
      #tarjeta-jugador h3 {
        text-align: center;
        margin-bottom: 8px;
        font-size: 1.4rem;
      }
      #tarjeta-jugador p {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: 5px;
        color: #333;
      }
      #tarjeta-jugador button {
        display: block;
        margin: 15px auto 0;
        background: #cc0000;
      }

      /* Modal de éxito */
      #modal-exito {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.4);
        z-index: 10000;
        align-items: center;
        justify-content: center;
      }
      #modal-exito div {
        background: white;
        padding: 30px 20px;
        border-radius: 12px;
        text-align: center;
        min-width: 250px;
      }
      #modal-exito h2 {
        color: green;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>Formulario Multipasos</header>

      <div class="progress-bar">
        <div class="step">
          <p class="active" id="step-1-text">Paso 1</p>
          <div class="bullet active" id="step-1-bullet"><span class="check active">&#10003;</span></div>
        </div>
        <div class="step">
          <p id="step-2-text">Paso 2</p>
          <div class="bullet" id="step-2-bullet"><span class="check">&#10003;</span></div>
        </div>
      </div>

      <div class="form-outer">
        <form id="form">
          <!-- Paso 1 -->
          <div class="page">
            <div class="field">
              <label for="nombre">Nombre:</label>
              <input type="text" id="nombre" required />
            </div>
            <div class="field">
              <label for="apellido">Apellido:</label>
              <input type="text" id="apellido" required />
            </div>
            <div class="field">
              <label for="telefono">Teléfono:</label>
              <input type="tel" id="telefono" required />
            </div>
            <div class="field">
              <label for="email">Correo electrónico:</label>
              <input type="email" id="email" required />
            </div>
          </div>

          <!-- Paso 2 -->
          <div class="page">
            <div id="jugadores">
              <!-- Jugadores para arrastrar -->
              <div class="jugador-wrapper">
                <div class="jugador" id="jugador1" draggable="true" data-nombre="Juan Pérez" data-numero="1" title="Juan Pérez - #1">1</div>
                <div class="tooltip">Juan Pérez - #1</div>
              </div>
              <div class="jugador-wrapper">
                <div class="jugador" id="jugador2" draggable="true" data-nombre="Carlos López" data-numero="2" title="Carlos López - #2">2</div>
                <div class="tooltip">Carlos López - #2</div>
              </div>
              <div class="jugador-wrapper">
                <div class="jugador" id="jugador3" draggable="true" data-nombre="Miguel Ruiz" data-numero="3" title="Miguel Ruiz - #3">3</div>
                <div class="tooltip">Miguel Ruiz - #3</div>
              </div>
              <div class="jugador-wrapper">
                <div class="jugador" id="jugador4" draggable="true" data-nombre="Luis Gómez" data-numero="4" title="Luis Gómez - #4">4</div>
                <div class="tooltip">Luis Gómez - #4</div>
              </div>
              <div class="jugador-wrapper">
                <div class="jugador" id="jugador5" draggable="true" data-nombre="Pedro Sánchez" data-numero="5" title="Pedro Sánchez - #5">5</div>
                <div class="tooltip">Pedro Sánchez - #5</div>
              </div>
            </div>

            <div id="cancha">
              <div class="posicion p1" data-pos="p1"></div>
              <div class="posicion p2" data-pos="p2"></div>
              <div class="posicion p3" data-pos="p3"></div>
              <div class="posicion p4" data-pos="p4"></div>
              <div class="posicion p5" data-pos="p5"></div>
              <div class="posicion p6" data-pos="p6"></div>
              <div class="posicion p7" data-pos="p7"></div>
              <div class="posicion p8" data-pos="p8"></div>
              <div class="posicion p9" data-pos="p9"></div>
              <div class="posicion p10" data-pos="p10"></div>
              <div class="posicion p11" data-pos="p11"></div>
            </div>
            <div id="cancha-capturada" style="text-align:center; margin:10px 0;"></div>

            <div class="btns">
              <button type="button" id="btn-atras">Atrás</button>
              <button type="button" id="btn-siguiente">Siguiente</button>
              <button type="button" id="btn-finalizar" style="display:none">Finalizar</button>
              <button type="button" id="btn-capturar" style="display:none">Capturar cancha</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Tarjeta jugador -->
    <div id="tarjeta-jugador">
      <img src="camiseta.png" alt="Imagen jugador" id="imagen-jugador" />
      <h3 id="nombre-jugador"></h3>
      <p>Número: <span id="numero-jugador"></span></p>
      <button id="btn-cerrar-tarjeta">Cerrar</button>
    </div>

    <!-- Modal de éxito -->
    <div id="modal-exito" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); z-index:10000; align-items:center; justify-content:center;">
      <div style="background:white; padding:30px 20px; border-radius:12px; text-align:center; min-width:250px;">
        <h2 style="color:green;">¡Registro finalizado con éxito!</h2>
        <p>Su formulario ha sido enviado correctamente.</p>
        <button id="btn-cerrar-modal" style="margin-top:15px; background:green;">Cerrar</button>
      </div>
    </div>

    <script>
      // Variables para pasos
      const form = document.getElementById("form");
      const pages = document.querySelectorAll(".page");
      const progressText = [document.getElementById("step-1-text"), document.getElementById("step-2-text")];
      const progressBullets = [document.getElementById("step-1-bullet"), document.getElementById("step-2-bullet")];
      const progressChecks = document.querySelectorAll(".check");
      let currentStep = 0;

      const btnAtras = document.getElementById("btn-atras");
      const btnSiguiente = document.getElementById("btn-siguiente");
      const btnFinalizar = document.getElementById("btn-finalizar");
      const btnCapturar = document.getElementById("btn-capturar");

      // Avanzar paso
      btnSiguiente.addEventListener("click", () => {
        if (currentStep < pages.length - 1) {
          currentStep++;
          updateForm();
        }
      });

      // Retroceder paso
      btnAtras.addEventListener("click", () => {
        if (currentStep > 0) {
          currentStep--;
          updateForm();
        }
      });

      // Actualizar UI formulario
      function updateForm() {
        form.style.marginLeft = `-${currentStep * 50}%`;
        progressText.forEach((p, i) => {
          if (i <= currentStep) {
            p.classList.add("active");
            progressBullets[i].classList.add("active");
            progressChecks[i].classList.add("active");
          } else {
            p.classList.remove("active");
            progressBullets[i].classList.remove("active");
            progressChecks[i].classList.remove("active");
          }
        });

        btnAtras.style.display = currentStep === 0 ? "none" : "inline-block";
        btnSiguiente.style.display = currentStep === pages.length - 1 ? "none" : "inline-block";
        btnFinalizar.style.display = currentStep === pages.length - 1 ? "inline-block" : "none";
        btnCapturar.style.display = currentStep === pages.length - 1 ? "inline-block" : "none";
      }
      updateForm();

      // Drag and Drop jugadores a posiciones
      const jugadores = document.querySelectorAll(".jugador");
      const posiciones = document.querySelectorAll(".posicion");

      jugadores.forEach((jugador) => {
        jugador.addEventListener("dragstart", dragStart);
        jugador.addEventListener("click", mostrarTarjetaJugador);
      });

      posiciones.forEach((pos) => {
        pos.addEventListener("dragover", dragOver);
        pos.addEventListener("drop", drop);
        pos.addEventListener("click", () => {
          // Si la posición tiene un jugador, mostrar info
          const jugador = pos.querySelector(".jugador");
          if (jugador) mostrarTarjetaJugador({ currentTarget: jugador });
        });
      });

      function dragStart(e) {
        e.dataTransfer.setData("text/plain", e.target.id);
      }
      function dragOver(e) {
        e.preventDefault();
      }
      function drop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData("text");
        const jugador = document.getElementById(id);

        // Si la posición ya tiene jugador, moverlo a la zona de jugadores para liberar
        if (e.target.classList.contains("posicion")) {
          const posicion = e.target;

          if (posicion.querySelector(".jugador")) {
            // Mover jugador actual fuera
            const jugadorExistente = posicion.querySelector(".jugador");
            document.getElementById("jugadores").appendChild(jugadorExistente);
          }

          posicion.appendChild(jugador);
          posicion.classList.add("drop-effect");
          setTimeout(() => {
            posicion.classList.remove("drop-effect");
          }, 300);
        }
      }

      // Mostrar tarjeta con info jugador
      const tarjeta = document.getElementById("tarjeta-jugador");
      const nombreJugadorElem = document.getElementById("nombre-jugador");
      const numeroJugadorElem = document.getElementById("numero-jugador");
      const imagenJugadorElem = document.getElementById("imagen-jugador");
      const btnCerrarTarjeta = document.getElementById("btn-cerrar-tarjeta");

      function mostrarTarjetaJugador(event) {
        let jugadorElem;
        if (event.currentTarget) {
          jugadorElem = event.currentTarget;
        } else {
          jugadorElem = event.target;
        }

        const nombre = jugadorElem.getAttribute("data-nombre");
        const numero = jugadorElem.getAttribute("data-numero");

        nombreJugadorElem.textContent = nombre;
        numeroJugadorElem.textContent = numero;
        imagenJugadorElem.src = "camiseta.png";

        tarjeta.style.display = "block";
      }

      btnCerrarTarjeta.addEventListener("click", () => {
        tarjeta.style.display = "none";
      });

      // Cerrar tarjeta si se hace click fuera
      document.addEventListener("click", (e) => {
        if (!tarjeta.contains(e.target) && !e.target.classList.contains("jugador")) {
          tarjeta.style.display = "none";
        }
      });

      // Validación de campos paso 1
      function validarPaso1() {
        const nombre = document.getElementById("nombre").value.trim();
        const apellido = document.getElementById("apellido").value.trim();
        const telefono = document.getElementById("telefono").value.trim();
        const email = document.getElementById("email").value.trim();
        return nombre && apellido && telefono && email;
      }

      // Validación de cancha llena
      function canchaCompleta() {
        return Array.from(document.querySelectorAll(".posicion")).every(pos => pos.querySelector(".jugador"));
      }

      // Mostrar imagen capturada en el formulario
      function mostrarImagenCapturada(imgData) {
        const div = document.getElementById("cancha-capturada");
        div.innerHTML = `<img src="${imgData}" alt="Cancha capturada" style="max-width:100%; border-radius:10px; border:2px solid #008000; margin-top:10px;" />`;
      }

      // Botón siguiente: validación de paso 1
      btnSiguiente.addEventListener("click", () => {
        if (currentStep === 0) {
          if (!validarPaso1()) {
            alert("Por favor, complete todos los campos del Paso 1.");
            return;
          }
        }
        currentStep++;
        updateForm();
      });

      // Botón finalizar: validación de cancha y captura imagen
      btnFinalizar.addEventListener("click", async () => {
        if (!canchaCompleta()) {
          alert("Debe colocar un jugador en cada posición de la cancha.");
          return;
        }
        // Captura la imagen de la cancha y la muestra en el formulario
        await html2canvas(document.getElementById("cancha")).then((canvas) => {
          const imgData = canvas.toDataURL("image/png");
          mostrarImagenCapturada(imgData);
        });
        // Muestra el modal de éxito
        document.getElementById("modal-exito").style.display = "flex";
      });

      // Botón capturar: solo muestra la imagen, no finaliza
      btnCapturar.addEventListener("click", () => {
        html2canvas(document.getElementById("cancha")).then((canvas) => {
          const imgData = canvas.toDataURL("image/png");
          mostrarImagenCapturada(imgData);
        });
      });

      // Cerrar modal de éxito
      document.getElementById("btn-cerrar-modal").addEventListener("click", () => {
        document.getElementById("modal-exito").style.display = "none";
        // Opcional: resetear formulario
        // location.reload();
      });
    </script>
  </body>
</html>
